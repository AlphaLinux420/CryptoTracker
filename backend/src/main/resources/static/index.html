<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Crypto Tracker</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
<h1>Crypto Tracker</h1>
<div>
  <label for="crypto-name">Search for Crypto:</label>
  <input type="text" id="crypto-name" name="crypto-name" />
  <button onclick="getCryptoData()">Search</button>
</div>

<h3>Crypto Information:</h3>
<img id="crypto-image" src="" alt="Crypto Image" width="50" height="50">
<div id="name"></div>
<div id="price"></div>
<div id="price-change"></div>
<div id="high-low"></div>
<div id="price-prediction"></div>

<h3>Price Change Chart:</h3>
<canvas id="crypto-chart" width="300" height="150"></canvas>

<script>
  let chart = null;

  function getCryptoData() {
    const cryptoName = document.getElementById("crypto-name").value;

    fetch(`http://localhost:8080/api/crypto/search/${cryptoName}`)
            .then(response => response.json())
            .then(data => {
              if (data) {

                document.getElementById("crypto-image").src = data.image;
                document.getElementById("name").innerText = data.name + " (" + data.symbol.toUpperCase() + ")";
                document.getElementById("price").innerText = 'Price: $' + data.currentPrice.toFixed(2);
                document.getElementById("price-change").innerText = 'Change Today: ' + data.priceChange24h.toFixed(2) + ' USD (' + data.priceChangePercentage24h.toFixed(2) + '%)';
                document.getElementById("high-low").innerText = 'High 24h: $' + data.high24h.toFixed(2) + ' | Low 24h: $' + data.low24h.toFixed(2);

                generatePricePrediction(data);

                fetch(`http://localhost:8080/api/crypto/historical-data/${cryptoName}`)
                        .then(response => response.json())
                        .then(histData => {
                          if (histData && histData.prices) {
                            const prices = histData.prices.map(item => item[1]);
                            const timestamps = histData.prices.map(item => new Date(item[0]).toLocaleDateString());

                            if (chart) {
                              chart.destroy();
                            }

                            const ctx = document.getElementById('crypto-chart').getContext('2d');
                            chart = new Chart(ctx, {
                              type: 'line',
                              data: {
                                labels: timestamps,
                                datasets: [{
                                  label: data.name + ' Price',
                                  data: prices,
                                  borderColor: 'rgba(75, 192, 192, 1)',
                                  fill: false
                                }]
                              }
                            });
                          }
                        })
                        .catch(error => {
                          console.error("Error fetching historical data:", error);
                        });
              } else {
                console.error("No data received for " + cryptoName);
              }
            })
            .catch(error => {
              console.error("Error fetching crypto data:", error);
            });
  }

  function generatePricePrediction(data) {
    const priceChange24h = data.priceChange24h;
    let prediction = 'Hold';

    if (priceChange24h > 0) {
      prediction = 'Buy';
    } else if (priceChange24h < 0) {
      prediction = 'Sell';
    }

    document.getElementById("price-prediction").innerText = 'Prediction: ' + prediction;
  }
</script>
</body>
</html>
